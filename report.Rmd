---
title: "Discerning malignant from benign breast cancer"
author: "Carlo van Buiten"
date: "11/2/2021"
output: pdf_document
linkcolor: blue
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(reshape2)
```

\newpage

```{r, warning=FALSE, message=FALSE}
data <- read.csv("breast-cancer-wisconsin.data", na.strings="?")
colnames(data) <- c("id", "Clump_Thickness", "Cell_Size_Uniformity", "Cell_Shape_Uniformity", "Marginal_Adhesion",
                    "Single_Epithelial_Cell_Size", "Bare_Nuclei", "Bland_Chromatin", "Normal_Nucleoli", "Mitoses",
                    "Class")

cor_data <- cor(data, use = "complete.obs")
cor_data <- as.data.frame(cor_data)
cor_cols <- names(cor_data)[which(cor_data$Class > 0.8)]

clean_data <- unique(data)
clean_data$Mitoses <- NULL
clean_data$Normal_Nucleoli <- NULL
clean_data$id <- NULL

```


## Abstract

\newpage
\tableofcontents
\newpage


## Introduction

### Theory
Breast cancer is, as the name suggests, a type of cancer that starts in the breast. One of the early signs of cancer is cell growth that is out of control, the resulting lumps do not always have to be malignant and are sometimes nothing to be worried about. Other times, however, these lumps are malignant and are, or increase the likelyhood of, cancer. It is for these types of lumps that it is extremely important to be able to determine early on whether or not this lump may result in potential life threatening situations later down the line. One way of handling the diagnosis of patients whose breast tissue is being examined is by looking at the breast tissue and examining the cells for specific characteristics. These include but are not limited to cell uniformity, rate of mitosis and the presence (or lack thereof) of cytoplasm in the nucleus.  



### Objective
The data used in this research contains 9 such characteristics, each of which has been graded by an examining doctor on a scale of 1 to 10, with 1 being the least cause for concern and 10 being the highest chance of malignancy. While the goal was initially the mere automation of the evaluation of all the grades through machine learning as opposed to by hand for each case, this research also aims to reduce the amount of characteristics (or attributes in machine learning terms) needed for a full diagnosis with a focus on preventing as many false negatives as possible, as this would expedite the process of tissue analysism. Ideally, a doctor would only have to look at a couple of aspects of the cells in the examined tissue, which would massively reduce the relative workload of any such examination. To this end, a viable combination of attributes has to be found with acceptable model accuracy.

\newpage

## Materials & Methods

The code and methodology described in this section can be found in the following two git repositories:  
[Research Repository](https://github.com/C-Buiten/Thema9) (R Visualizations and logs).  
[Code Repository](https://github.com/C-Buiten/Thema9_Wrapper) (Java wrapper for the (re-)application of the machine learning model).  

The user manual for the data can be found by clicking the following link:
[User Manual](https://www.rai-light.com/docs/BCD_User_Manual_v01.pdf).  

### Materials
The data used in this research was comprised of cell data of 698 different patients. For each of these patients, 9 grades (on a scale from 1 to 10) were given, one grade for each of the following tissue attributes: Clump thickness, cell size uniformity, cell shape uniformity, marginal adhesion, single epithelial cell size, bare nuclei, bland chromatin, normal_nucleoli and mitoses. For each of these attributes 1 was considered the closest to normal and 10 the most abnormal or cancer-like. For the cleaning and visualizing of the data R was used in conjunction with ggplot2 for the making of graphs. The machine learning algorithms were tested and applied through weka. The resulting model was then wrapped inside a Java application for reproduction purposes.

Software   Version    
--------   --------------
Weka       3.8
R          3.6.3 
ggplot2    3.3.5
Java       14.0.2
---------  --------------

Table: Table of the used software versions.


### Methods
Before beginning the modeling in weka, the dataset had to be cleaned first. All entries containing missing values were removed, as were the attributes mitoses and normal nucleoli and the column containing arbitrary patient ID numbers as these were of no concern for the model. Mitoses and normal nucleoli were both removed on account of them having a low correlation with the target class and being ill-defined in the user manual.  

The cleaned up data was then exported to weka, whose selection of classifiers were then tested on the newly cleaned data. The most notable of these classifiers were OneR, VotedPerceptron, NaiveBayes, Logistic and Bagging. The last two performed equally well and also outperformed all the others. As such, these were then used for further testing with a cost sensitive classifier, as the most meaningful improvement to their already high performance at the time was deemed the reduction of false negatives. When both these classifiers were used in a situation where false negatives outweighed false positives with a factor of 1.2 to 1, the logistic classifer saw the biggest improvement. The logistic classifier was then tried out with a cost ratio of 4 to 1, which improved its performance even further. Any increase in weight at this point was detrimental to its performance and as such this setup was the classifier that was settled on for the final model. This model was then exported and integrated in a java wrapper.


## Results

```{r, warning=FALSE, message=FALSE}
cor_matrix <- round(cor(na.omit(clean_data)),2)
melted_cor_matrix <- melt(cor_matrix, value.name = "Correlation")

ggplot(data = melted_cor_matrix, aes(x=Var1, y=Var2, fill=Correlation, )) + 
  geom_tile() +
  labs(y="", x="", 
       caption="Figure 1: Heatmap showing the correlations between all attributes.") +
  scale_fill_gradient(low="black", high="red") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 40, hjust = 1)) +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0.5))

clean_data$Class[clean_data$Class == 2] <- "B"
clean_data$Class[clean_data$Class == 4] <- "M"
```

As can be seen in figure 1, there are 4 attributes that correlate with malignancy (class) for more than 75%, 2 of which are pertaining to cell uniformity. These attributes are cell size uniformity, cell shape uniformity, bare nuclei and bland chromatin. The spreads for these attributes can be seen in figures 2 through 5.

```{r, warning=FALSE, message=FALSE}
ggplot(data=clean_data, mapping = aes(x = Class, y = Cell_Size_Uniformity)) +
  geom_jitter(width = 0.05, height = 0.3, col="red", alpha = 0.3, size = 0.5) +
  labs(y="Cell Size Uniformity", 
       caption="Figure 2: Cell size uniformity spread per class.") +
  theme_minimal() +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0.5))
```

```{r, warning=FALSE, message=FALSE}
ggplot(data=clean_data, mapping = aes(x = Class, y = Cell_Shape_Uniformity)) +
  geom_jitter(width = 0.05, height = 0.3, col="darkgreen", alpha = 0.3, size = 0.5) +
  labs(y="Cell Shape Uniformity", 
       caption="Figure 3: Cell shape uniformity spread per class.") +
  theme_minimal() +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0.5))
```

```{r, warning=FALSE, message=FALSE}
ggplot(data=clean_data, mapping = aes(x = Class, y = Bare_Nuclei)) +
  geom_jitter(width = 0.05, height = 0.3, col="blue", alpha = 0.3, size = 0.5) +
  labs(y="Nuclei With Cytoplasm", 
       caption="Figure 4: Bare nuclei spread per class.") +
  theme_minimal() +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0.5))
```

```{r, warning=FALSE, message=FALSE}
ggplot(data=clean_data, mapping = aes(x = Class, y = Bland_Chromatin)) +
  geom_jitter(width = 0.05, height = 0.3, col="darkturquoise", alpha = 0.3, size = 0.5) +
  labs(y="Bland Chromatin", 
       caption="Figure 5: Bland Chromatin spread per class.") +
  theme_minimal() +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0.5))
```


```{r, warning=FALSE, message=FALSE}
ggplot(data=clean_data, mapping = aes(x = Cell_Size_Uniformity, y = Cell_Shape_Uniformity)) +
  geom_jitter(width = 0.35, height = 0.35, alpha = 0.3, size = 0.5, aes(col=Class)) +
  geom_smooth(method = "lm", se = T) +
  labs(y="Cell Shape Uniformity", x="Cell Size Uniformity", 
       caption="Figure 6: Plot of the correlation between cell shape and size discrepancies") +
  theme_minimal() +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0.5))
```

Cell size uniformity and cell shape uniformity (see figure 6) seem to correlate quite a lot, although this correlation seems to wane a little at the higher end. This correlation entails that the larger the differences in size between cells, the larger the differences in shapes as well.


\newpage

## Discussion & Conclusion

### Discussion

Murky murky onzekerheid 50% false positives/negatives/uitgewisseld
enkel goedkeuren van arts zijn expertise

Most features that have to do with erratic cell growth seem to correlate strongly with the malignancy of the cases of breast cancer, this makes sense as one of the defining aspects of cancer is the abnormal growth and multiplication of cells.

Taking all the results and graphs at face value, one might say cell uniformity is a strong predictor of malignant breast cancer. While this might be the case, some assumptions have to be made in order for us to be able to draw this conclusion. This is because in the user manual the grades (ranging from 1 to 10) are defined as "Completely uniform", followed by an amount of percentages (90% to 10%) and eventually ending at "Cells are inconsistent with their uniformity". This means that at the very least some rounding has been done, which is automatically a loss of information. It is also unclear how one would measure uniformity for cells in a tissue sample in terms of percentages, or specifically; how these were measured in this study.

The unspecific nature of the data is a glaring issue when it comes to drawing hard conclusions, but assuming the integrity of the data is in order, we may potentially verify the hypothesis.


### Conclusion

Barring the accuracy of the data (or rather the potential lack thereof), we can safely conclude that cell uniformity is a good predictor for the malignancy of breast cancer.

